{"componentChunkName":"component---src-templates-blog-template-js","path":"/tech-talk-2021/2021-02-04-SSL-setting-webpack-dev-server/","result":{"data":{"cur":{"id":"7982c4a0-5858-5fb0-b2e3-71821866184c","html":"<h2 id=\"소개\" style=\"position:relative;\"><a href=\"#%EC%86%8C%EA%B0%9C\" aria-label=\"소개 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><strong>소개</strong></h2>\n<ul>\n<li>Node.js 환경에서 https설정하는 방법을 설명한다.</li>\n<li>현재 <code class=\"language-text\">my.example.com</code>은 이미 <code class=\"language-text\">cert</code>, <code class=\"language-text\">key</code> 가 존재한다.</li>\n<li>다만 해당 파일이 <code class=\"language-text\">pem</code>파일로 되어있고, 현재는 <code class=\"language-text\">nginx</code>의 https의 설정용으로 되어 있다.\n<ul>\n<li>또한 현재 nginx용 ssl은 <code class=\"language-text\">pass</code>을 받게 되어 있다.</li>\n</ul>\n</li>\n<li>따라서, node에서 해당 ssl(cert, key)을 바로 사용하는 경우 에러가 발생한다.</li>\n<li>현재 이미 있는 nginx용 ssl을 node.js(webpack-dev-server)에서 사용하는 방법을 설명한다.</li>\n</ul>\n<h2 id=\"nodejs-에서-https설정하기\" style=\"position:relative;\"><a href=\"#nodejs-%EC%97%90%EC%84%9C-https%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\" aria-label=\"nodejs 에서 https설정하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><strong>Node.js 에서 https설정하기</strong></h2>\n<ul>\n<li>정상적인 ssl(cert, key)가 존재하는 경우 아래와 같은 코드로 https설정이 가능하다.</li>\n<li>공식Doc - <a href=\"https://nodejs.org/api/https.html\">https://nodejs.org/api/https.html</a></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// curl -k https://localhost:8000/</span>\n<span class=\"token keyword\">const</span> https <span class=\"token operator\">=</span> <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  key<span class=\"token operator\">:</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test/fixtures/keys/agent2-key.pem'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  cert<span class=\"token operator\">:</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test/fixtures/keys/agent2-cert.pem'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nhttps<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello world\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">8000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// 또는</span>\n<span class=\"token keyword\">const</span> https <span class=\"token operator\">=</span> <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  pfx<span class=\"token operator\">:</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test/fixtures/test_cert.pfx'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  passphrase<span class=\"token operator\">:</span> <span class=\"token string\">'sample'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nhttps<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello world\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">8000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Node의 공식 문서에서 알 수 있는 사실</p>\n<ul>\n<li>확장자가 <code class=\"language-text\">pem</code>, <code class=\"language-text\">key</code>, <code class=\"language-text\">pfx</code>, <code class=\"language-text\">cert</code>을 다 지원 가능</li>\n<li>ca을 넣지 않아도 무방</li>\n<li>pass을 넣는 부분은 없음</li>\n</ul>\n<h2 id=\"express에서-https설정하기\" style=\"position:relative;\"><a href=\"#express%EC%97%90%EC%84%9C-https%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\" aria-label=\"express에서 https설정하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><strong>Express에서 https설정하기</strong></h2>\n<ul>\n<li>가장 기본이 되는 Node의 설정과 거의 동일하다.</li>\n<li><code class=\"language-text\">webpack-dev-server</code>는 내부적으로 <code class=\"language-text\">express.js</code>을 사용하고 있기 때문에, <code class=\"language-text\">express.js</code>에서 정상 동작하면 사실상 <code class=\"language-text\">webpack-dev-server</code>에서 정상 동작한다.</li>\n<li>이게 되면 사실상 거의 비슷한 구조인 <code class=\"language-text\">koa2.js</code>역시 동일한 형태로 <code class=\"language-text\">https</code>설정이 가능하다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> https <span class=\"token operator\">=</span> <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 더미 라우트 모든 req에 대해서 result을 res</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token string\">'result'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">PORT</span> <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PORT</span> <span class=\"token operator\">||</span> <span class=\"token number\">4431</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// HTTPS 는 443 포트를 사용합니다</span>\n\n<span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  key<span class=\"token operator\">:</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span>__dirname <span class=\"token operator\">+</span> <span class=\"token string\">'/key.pem'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  cert<span class=\"token operator\">:</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span>__dirname <span class=\"token operator\">+</span> <span class=\"token string\">'/cert.pem'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// https 서버를 만들고 실행시킵니다</span>\nhttps<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">,</span> app<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Server start!!!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// 또는 아래와 같이 https와 http둘다 지원되는 서버 구축 가능</span>\n<span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> https <span class=\"token operator\">=</span> <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> http <span class=\"token operator\">=</span> <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  key<span class=\"token operator\">:</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'key.pem'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  cert<span class=\"token operator\">:</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cert.cert'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// pem이건 cert이건 확장과 관계없음, 이는 base인 node.js가 지원해서 가능</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Create a service (the app object is just a callback).</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Create an HTTP service.</span>\nhttp<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">80</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Create an HTTPS service identical to the HTTP service.</span>\nhttps<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">,</span> app<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">443</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"webpack-dev-server의-https설정\" style=\"position:relative;\"><a href=\"#webpack-dev-server%EC%9D%98-https%EC%84%A4%EC%A0%95\" aria-label=\"webpack dev server의 https설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><strong>webpack-dev-server의 https설정</strong></h2>\n<ul>\n<li>참고: <a href=\"https://webpack.js.org/configuration/dev-server/#devserverhttps\">https://webpack.js.org/configuration/dev-server/#devserverhttps</a></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">//...</span>\n  devServer<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    https<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      key<span class=\"token operator\">:</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/path/to/server.key'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      cert<span class=\"token operator\">:</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/path/to/server.crt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      ca<span class=\"token operator\">:</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/path/to/ca.pem'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>문서상, webpack devServer설정상의 <code class=\"language-text\">https</code> object설정이 그대로, 더 위에서 설명한, node 혹은 express설정의 https생성(createServer) optioins로 들어간다.</li>\n<li>This object is passed straight to Node.js HTTPS module, so see the <a href=\"https://nodejs.org/api/https.html\">HTTPS documentation</a> for more information.</li>\n</ul>\n<h2 id=\"ssl키-local에서-생성해보기\" style=\"position:relative;\"><a href=\"#ssl%ED%82%A4-local%EC%97%90%EC%84%9C-%EC%83%9D%EC%84%B1%ED%95%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"ssl키 local에서 생성해보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><strong>ssl키 local에서 생성해보기</strong></h2>\n<ul>\n<li>참고: <a href=\"https://www.notion.so/cbc326896d9cc4d240201e3f59690ac9\">https://gist.github.com/gseok/cbc326896d9cc4d240201e3f59690ac9</a></li>\n</ul>\n<p><strong>pre-required</strong></p>\n<ul>\n<li>openssl 이 있어야 한다.</li>\n</ul>\n<p><strong>ssl.conf</strong></p>\n<ul>\n<li>cert파일 생성시 사용되는, ssl 설정 파일</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token punctuation\">[</span> req <span class=\"token punctuation\">]</span>\ndefault_bits       <span class=\"token operator\">=</span> <span class=\"token number\">4096</span>\ndistinguished_name <span class=\"token operator\">=</span> req_distinguished_name\nreq_extensions     <span class=\"token operator\">=</span> req_ext\n\n<span class=\"token punctuation\">[</span> req_distinguished_name <span class=\"token punctuation\">]</span>\ncountryName                 <span class=\"token operator\">=</span> <span class=\"token constant\">IL</span>\ncountryName_default         <span class=\"token operator\">=</span> <span class=\"token constant\">GB</span>\nstateOrProvinceName         <span class=\"token operator\">=</span> Center\nstateOrProvinceName_default <span class=\"token operator\">=</span> England\nlocalityName                <span class=\"token operator\">=</span> Tel Aviv\nlocalityName_default        <span class=\"token operator\">=</span> Brighton\norganizationName            <span class=\"token operator\">=</span> <span class=\"token constant\">CA</span>\norganizationName_default    <span class=\"token operator\">=</span> Hallmarkdesign\norganizationalUnitName      <span class=\"token operator\">=</span> BlazeMeter\ncommonName                  <span class=\"token operator\">=</span> localhost\ncommonName_max              <span class=\"token operator\">=</span> <span class=\"token number\">64</span>\ncommonName_default          <span class=\"token operator\">=</span> localhost\n\n<span class=\"token punctuation\">[</span> req_ext <span class=\"token punctuation\">]</span>\nsubjectAltName <span class=\"token operator\">=</span> @alt_names\n\n<span class=\"token punctuation\">[</span>alt_names<span class=\"token punctuation\">]</span>\n<span class=\"token constant\">DNS</span><span class=\"token number\">.1</span>   <span class=\"token operator\">=</span> localhost</code></pre></div>\n<p><strong>Generate private key</strong></p>\n<ul>\n<li>비공개키 생성</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ openssl genrsa -out private.key 4096</code></pre></div>\n<p><strong>Generate a Certificate Signing Request</strong></p>\n<ul>\n<li>비공개키와, ssl.conf(ssl 설정 파일)을 이용해서, sign파일(csr) 생성</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">openssl req -new -sha256 \\\n    -out private.csr \\\n    -key private.key \\\n    -config ssl.conf\n</code></pre></div>\n<p><strong>Generate the certificate</strong></p>\n<ul>\n<li>비공개키 + 키 sign 파일 두개를 이용해서, cert 파일 생성(실질적인 인증서 파일!)</li>\n<li>이때도 ssl.conf는 동일하게 사용됨</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">openssl x509 -req \\\n    -days 3650 \\\n    -in private.csr \\\n    -signkey private.key \\\n    -out private.crt \\\n    -extensions req_ext \\\n    -extfile ssl.conf</code></pre></div>\n<p><strong>Add the certificate to keychain and trust it:</strong></p>\n<ul>\n<li>local에서 생성한 ssl용 cert파일은, 공식 인증기관에서 인증한 키가 아니기 때문에 실제 사용시 브라우저에서, ```알수없는 인증기관“에서 인증 과련 경고가 발생</li>\n<li>아래 로직은 임의로, 본인 컴퓨터에서 해당 key을 <code class=\"language-text\">믿을만한</code>키로 인식 하는 방법(개발용) 이다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain private.crt</code></pre></div>\n<p><strong>Create a pem file from crt</strong></p>\n<ul>\n<li>위 과정상으로 확장자가 crt인 인증서파일을 생성하였는데, 이 확장자를 openssl명령어로 벼경 가능하다.</li>\n<li>쉽게 이해하자면, 특정 유틸프로그램(openssl)로 <code class=\"language-text\">jpg > png</code>하는것과 비슷하다.\n<ul>\n<li>즉 실질적인 기능은 동일한데, 확장자(내부 format)이 다른 type형태로 전환 가능</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">openssl x509 -in private.crt -out private.pem -outform PEM</code></pre></div>\n<p><strong>Run webpack dev server</strong></p>\n<ul>\n<li>로컬에서 생성한 ssl (key and cert)을 가지고 webpack-dev-server or node.js 에서 https로 사용 가능하다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm run webpack-dev-server -- --open --https --cert private.pem --key private.key</code></pre></div>\n<h2 id=\"ssl키-type-혹은-확장자-변경\" style=\"position:relative;\"><a href=\"#ssl%ED%82%A4-type-%ED%98%B9%EC%9D%80-%ED%99%95%EC%9E%A5%EC%9E%90-%EB%B3%80%EA%B2%BD\" aria-label=\"ssl키 type 혹은 확장자 변경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><strong>ssl키 type 혹은 확장자 변경</strong></h2>\n<ul>\n<li>위 간략한 ssl키 local에서 생성 과정에서 알수 있듯, openssl로 ssl이 생성한 파일의 type(pem, key, crt 등)을 변경하거나, pem 에서 key을 추출하는등의 동작이 가능하다.</li>\n<li>참고: <a href=\"https://stackoverflow.com/questions/13732826/convert-pem-to-crt-and-key\">https://stackoverflow.com/questions/13732826/convert-pem-to-crt-and-key</a></li>\n<li>참고: <a href=\"https://stackoverflow.com/questions/991758/how-to-get-pem-file-from-key-and-crt-files\">https://stackoverflow.com/questions/991758/how-to-get-pem-file-from-key-and-crt-files</a></li>\n<li>여기서는 몇가지 방법반 소개한다. 더 많은 방법은 위 참고 부분을 확인</li>\n</ul>\n<p><strong>pem 파일에서 key &#x26; cert추출</strong></p>\n<ul>\n<li>즉 key.pem -> key.key</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">openssl pkey <span class=\"token operator\">-</span><span class=\"token keyword\">in</span> <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>cert<span class=\"token operator\">/</span>key<span class=\"token punctuation\">.</span>pem <span class=\"token operator\">-</span>out key<span class=\"token punctuation\">.</span>key\n<span class=\"token comment\">// 위 명령어 시도시, Enter pass phrase 요청이 나옴 이때, nginx에서 쓰는 ssl.pass 파일에 기록된 값을 사용</span></code></pre></div>\n<ul>\n<li>또는</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">openssl rsa -in foo.pem -out foo.key</code></pre></div>\n<p><strong>Convert a DER file (.crt .cer .der) to PEM</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">openssl x509 -inform der -in certificate.cer -out certificate.pem</code></pre></div>\n<p><strong>Convert a PEM file to DER</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">openssl x509 -outform der -in certificate.pem -out certificate.der</code></pre></div>\n<p><strong>Convert PEM to CRT (.CRT file)</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">openssl x509 -outform der -in certificate.pem -out certificate.crt</code></pre></div>\n<p><strong>Convert PEM to PFX</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">openssl pkcs12 -export -out certificate.pfx -inkey privateKey.key -in certificate.crt -certfile CACert.crt</code></pre></div>\n<p><strong>To remove the pass phrase on an RSA private key</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"> openssl rsa -in key.pem -out keyout.pem</code></pre></div>\n<ul>\n<li>pem 파일에서 key &#x26; cert추출 와 동일</li>\n<li>설명상 실질적으로는 pem에서 pass phrase을 제거(혹은 추가?) 하는 역할</li>\n</ul>\n<h2 id=\"이미-있는-nginx용-ssl을-nodejswebpack-dev-server에서-사용하는-방법\" style=\"position:relative;\"><a href=\"#%EC%9D%B4%EB%AF%B8-%EC%9E%88%EB%8A%94-nginx%EC%9A%A9-ssl%EC%9D%84-nodejswebpack-dev-server%EC%97%90%EC%84%9C-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\" aria-label=\"이미 있는 nginx용 ssl을 nodejswebpack dev server에서 사용하는 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><strong>이미 있는 nginx용 ssl을 node.js(webpack-dev-server)에서 사용하는 방법</strong></h2>\n<ul>\n<li>사실상 위의 openssl을 사용하여, pem -> key 추출 등의 여러 명령어를 사용하여, node에서 사용가능하게 변경하면 된다.\n<ul>\n<li>각 nginx ssl환경에 맞는 파일을 -> node 환경에서 사용가능하게 변경 후 사용하면됨…</li>\n</ul>\n</li>\n<li>여기서는 my.example.com에서 사용하는 nginx용 인증서를 node용으로 바꾸는 부분만 간략하게 다룬다</li>\n</ul>\n<p><strong>nginx인증서</strong></p>\n<ul>\n<li><code class=\"language-text\">cert.pem</code>, <code class=\"language-text\">key.pem</code>, <code class=\"language-text\">ssl.pass</code> 3개의 파일로 구성되어 있음\n<ul>\n<li>주의!! - nginx하위에 현재 설정된, ssl.conf는 nginx용 conf이지 openssl에서 key, cert을 생성하기위한 conf가 아님!!!</li>\n</ul>\n</li>\n<li>일단 cert와, key가 pem으로 되어 있고, pass(passwd)사용하는걸 알 수 있다.</li>\n<li>node에서 사용하려면\n<ul>\n<li>A. <code class=\"language-text\">pfx</code> 형태로 바꾸고 node 쪽의 https설정(createServer)에서 pass을 넘겨주는 형태</li>\n<li>B. <code class=\"language-text\">key.pem</code>에서 pass을 추출(혹은 합산)해서 key을 생성하고 사용하는 형태</li>\n</ul>\n</li>\n<li>위와같이 2개의 방법을 사용 할 수 있다.\n<ul>\n<li>A.의 경우 CA인증서가 필요하고, cert.pem에서 crt파일로 변경이 필요함</li>\n<li>B.의 경우, <code class=\"language-text\">key.pem -> key.key</code> 형태로 변경 후 사용 가능.</li>\n</ul>\n</li>\n</ul>\n<p><strong>실제 적용</strong></p>\n<ul>\n<li>실제 서버의 webpack-dev-server에서는 B 형태로 작업하였다.</li>\n<li>pem -> key 변경(pass추출or합산)</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">openssl pkey <span class=\"token operator\">-</span><span class=\"token keyword\">in</span> <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>cert<span class=\"token operator\">/</span>key<span class=\"token punctuation\">.</span>pem <span class=\"token operator\">-</span>out key<span class=\"token punctuation\">.</span>key</code></pre></div>\n<ul>\n<li>cert는 기존꺼 그대로 사용해도 됨(pem이여도됨)</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> https <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token string\">'result'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">PORT</span> <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PORT</span> <span class=\"token operator\">||</span> <span class=\"token number\">4431</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// HTTPS 는 443 포트를 사용합니다</span>\n\n<span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token comment\">// pem -> key 확장자 만드는 위 명령어로 생성한놈, 생성시 pass잘 넣어야 정상 생서욈</span>\n  <span class=\"token literal-property property\">key</span><span class=\"token operator\">:</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span>__dirname <span class=\"token operator\">+</span> <span class=\"token string\">'/key.key'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token comment\">// cert는 기존 pem그대로 사용 가능</span>\n  <span class=\"token literal-property property\">cert</span><span class=\"token operator\">:</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span>__dirname <span class=\"token operator\">+</span> <span class=\"token string\">'/cert/cert.pem'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// https 서버를 만들고 실행시킵니다</span>\nhttps<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">,</span> app<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Server start!!!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>서버 구동됨</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 13.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAtklEQVQI12PIWXA8febe9LmHUmftT52xJ232gdTpe7IWnggsn6RrZmbh7mbs4GDt5Gbn5mXj7G7p4OLg7u3o4WNu72zh4MIQ1744pmFmRP2s6KY5cc2zY1vmR9XNiG1d4JpUqmtmbuHuamRv7+Dm7eEf7OTpa+vi4eEf5OEf7ODhY+viwWBpY2Pn4KhrYGhqYeno4mpibqFnaKSrb6Cqpa1lZKahZ6JpYKqub6yqa6iubwxhwNkARc45CF7sW48AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"01\"\n        title=\"01\"\n        src=\"/static/49c32f06a4c7fdbb6dcdd1f699983842/37523/01.png\"\n        srcset=\"/static/49c32f06a4c7fdbb6dcdd1f699983842/e9ff0/01.png 180w,\n/static/49c32f06a4c7fdbb6dcdd1f699983842/f21e7/01.png 360w,\n/static/49c32f06a4c7fdbb6dcdd1f699983842/37523/01.png 720w,\n/static/49c32f06a4c7fdbb6dcdd1f699983842/302a4/01.png 1080w,\n/static/49c32f06a4c7fdbb6dcdd1f699983842/6c2de/01.png 1334w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>접속시 정상 동작</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC10lEQVQoz4WSW0/TYBjHe42HeDsGbOvatW/ft6e1Xfv2tLbrxkFQg4gh0ZhojDoO8cBBP4+HmPgBvDBEE5VABn4DF7gg3kFCpBsMUgM1imLik9/t7/88+echgsqAaXkGdgK/33GDGzdvsSzX1XWGJPO5HEmSeYoqZDLZ82fPp1JpVTMYhsvmqCxJZ3MUYegmNmxsu9WLgyXdMrBFF0A63ZvPF8g8TVEMRTNknk739GWyeQBQgeEommEBhEgkLo8MX796bfzmxL1nd4cGL0FBtHw3GKraFc8N/XItCIZrpu8Gg1Un9O3QC0f6dduCUHRcn/jabK5vbKyvr29ufnv1+g2SJafmiYrCsJAFiOWOYFj4GwA5KKS6eyenZogoig4PDzsHB3Ecv1t8D3mxWhss6SbGDjZtjG3H9UzLwdg2LddxfdcNTMtlAXr8ZJ7Y2tra3f3earXiOP74cUlR9bHxidGx8ZHLV7xwKBwYHRgZ98NhAzu6YWHLtexy0sujx7PE9vb27m60t9eO487S8ieKZiVZVTVDlBWAJChoSNQgX2RYSBcARbN5igEcn+runZ1bIHZ2dqIoardb+4c7ix/eclDUDcsPqo7jV8J+t+yzAAIOsQAVlZJpubbj8YKc6u6bnZsn2u12FEX7+/txHK+tfaELQC5qWgkrqq5qRlEpAU4AHM8CxAuyXNTkonYsH2+OjieRG6urOZIGHP+z6mM4KCQkEUlKT29ubm6BaLVav+Tl5RUD20GlFlRqpl02LRfxEgsQ4PiEJAXxUronc3T2SbnRaDAsSg5Dgox4iUNisvMk/5ZXVlZUzfD8EJtOSTdLhmU5XtmrQCT+X240ViESVc2QZLWolCRZRbx0GlFS+jLk/PzTP+TPS0s0wwmSIopFA9tJq+mezF/0Zciz5y4cvWcidzqdOI6bzeb9+/X65HS9Pv2gPlWfnJ6cmjnN9MzD23fuPn/x8gdsJFsjYKUCjwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"02\"\n        title=\"02\"\n        src=\"/static/0e52592c429ad80f20bf1cd7886aa405/37523/02.png\"\n        srcset=\"/static/0e52592c429ad80f20bf1cd7886aa405/e9ff0/02.png 180w,\n/static/0e52592c429ad80f20bf1cd7886aa405/f21e7/02.png 360w,\n/static/0e52592c429ad80f20bf1cd7886aa405/37523/02.png 720w,\n/static/0e52592c429ad80f20bf1cd7886aa405/302a4/02.png 1080w,\n/static/0e52592c429ad80f20bf1cd7886aa405/b1001/02.png 1380w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>webpack-dev-server</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token literal-property property\">devServer</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">public</span><span class=\"token operator\">:</span> <span class=\"token string\">'local-my.example.com:3132'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">https</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">key</span><span class=\"token operator\">:</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>__dirname<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/../../nginx-conf/certificate/key.key</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">cert</span><span class=\"token operator\">:</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>__dirname<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/../../nginx-conf/certificate/cert.pem</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">publicPath</span><span class=\"token operator\">:</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">port</span><span class=\"token operator\">:</span> <span class=\"token number\">3132</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">hot</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">open</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">inline</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">writeToDisk</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">disableHostCheck</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">historyApiFallback</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">compress</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<h2 id=\"추가-내용\" style=\"position:relative;\"><a href=\"#%EC%B6%94%EA%B0%80-%EB%82%B4%EC%9A%A9\" aria-label=\"추가 내용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><strong>추가 내용</strong></h2>\n<ul>\n<li>webpack-dev-server의 https 설정은, 그 설정 그대로 node의 설정에 들어간다고 생각해도 된다.</li>\n<li>node 에서 <code class=\"language-text\">passphrase: 'sample'</code>와 같이 비번(passphrase)을 직접 입력하면, 굳이 pem 으로 (pass추출or합산) 하지 않아도 동작 가능하다.</li>\n<li>다만 이 글에서는 코드내에 passwd 노출이 싫었고, 각 파일들 pem, crt, key을 추출 합산 하는게 가능하다는걸 소개하고 싶었다. 각 개발 환경에 맞게 응용해서 쓰면 될꺼 같다.</li>\n</ul>\n<h2 id=\"좀더알기\" style=\"position:relative;\"><a href=\"#%EC%A2%80%EB%8D%94%EC%95%8C%EA%B8%B0\" aria-label=\"좀더알기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><strong>좀더알기</strong></h2>\n<ul>\n<li>SSL?\n<ul>\n<li><a href=\"https://wiki.kldp.org/HOWTO/html/SSL-Certificates-HOWTO/x70.html\">https://wiki.kldp.org/HOWTO/html/SSL-Certificates-HOWTO/x70.html</a></li>\n<li><a href=\"https://offbyone.tistory.com/274\">https://offbyone.tistory.com/274</a></li>\n</ul>\n</li>\n<li>ssl 파일 포멧?\n<ul>\n<li><a href=\"https://www.sslcert.co.kr/guides/kb/54\">https://www.sslcert.co.kr/guides/kb/54</a></li>\n<li><a href=\"https://www.letmecompile.com/certificate-file-format-extensions-comparison/\">https://www.letmecompile.com/certificate-file-format-extensions-comparison/</a></li>\n</ul>\n</li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#%EC%86%8C%EA%B0%9C\"><strong>소개</strong></a></li>\n<li><a href=\"#nodejs-%EC%97%90%EC%84%9C-https%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\"><strong>Node.js 에서 https설정하기</strong></a></li>\n<li><a href=\"#express%EC%97%90%EC%84%9C-https%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\"><strong>Express에서 https설정하기</strong></a></li>\n<li><a href=\"#webpack-dev-server%EC%9D%98-https%EC%84%A4%EC%A0%95\"><strong>webpack-dev-server의 https설정</strong></a></li>\n<li><a href=\"#ssl%ED%82%A4-local%EC%97%90%EC%84%9C-%EC%83%9D%EC%84%B1%ED%95%B4%EB%B3%B4%EA%B8%B0\"><strong>ssl키 local에서 생성해보기</strong></a></li>\n<li><a href=\"#ssl%ED%82%A4-type-%ED%98%B9%EC%9D%80-%ED%99%95%EC%9E%A5%EC%9E%90-%EB%B3%80%EA%B2%BD\"><strong>ssl키 type 혹은 확장자 변경</strong></a></li>\n<li><a href=\"#%EC%9D%B4%EB%AF%B8-%EC%9E%88%EB%8A%94-nginx%EC%9A%A9-ssl%EC%9D%84-nodejswebpack-dev-server%EC%97%90%EC%84%9C-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\"><strong>이미 있는 nginx용 ssl을 node.js(webpack-dev-server)에서 사용하는 방법</strong></a></li>\n<li><a href=\"#%EC%B6%94%EA%B0%80-%EB%82%B4%EC%9A%A9\"><strong>추가 내용</strong></a></li>\n<li><a href=\"#%EC%A2%80%EB%8D%94%EC%95%8C%EA%B8%B0\"><strong>좀더알기</strong></a></li>\n</ul>\n</div>","excerpt":"소개 Node.js 환경에서 https설정하는 방법을 설명한다. 현재 은 이미 ,  가 존재한다. 다만 해당 파일이 파일로 되어있고, 현재는 의 https의 설정용으로 되어 있다. 또한 현재 nginx용 ssl은 을 받게 되어 있다. 따라서, node에서 해당 ssl(cert, key)을 바로 사용하는 경우 에러가 발생한다. 현재 이미 있는 nginx용 ssl을 node.js(webpack-dev-server)에서 사용하는 방법을 설명한다. Node.js 에서 https설정하기 정상적인 ssl(cert, key)가 존재하는 경우 아래와 같은 코드로 https설정이 가능하다. 공식Doc - https://nodejs.org/api/https.html Node의 공식 문서에서 알 수 있는 사실 확장자가 , , , 을 다 지원 가능 ca을 넣지 않아도 무방 pass을 넣는 부분은 없음 Express에서 https설정하기 가장 기본이 되는 Node의 설정과 거의 동일하다. 는 내부적으로 …","frontmatter":{"date":"February 04, 2021","title":"SSL, Https 설정 in Node.js And webpack dev server","categories":"tech-talk bundler","author":"gseok","emoji":null},"fields":{"slug":"/tech-talk-2021/2021-02-04-SSL-setting-webpack-dev-server/"}},"next":{"id":"058f9dce-3370-537f-8225-5472a40aef38","html":"<h3 id=\"소개\" style=\"position:relative;\"><a href=\"#%EC%86%8C%EA%B0%9C\" aria-label=\"소개 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>소개</h3>\n<p>node application에서 흔하게 사용하는 enviroment 변수의 사용에 대해서 간략히 알아봅니다.</p>\n<p><strong>enviroment 개념</strong></p>\n<p>어떤 process환경에서 접근 가능한 변수(key-value)를 의미 합니다. unix 환경을 사용하고 있다면 간단히 다음 명령어로 현재 shell의 환경 변수를 알 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">printenv</span></code></pre></div>\n<p>window의 환경에서 JAVA_HOME등을 위해서 설정하는 환경변수등이 이러 변수의 대표적인 예 입니다.</p>\n<p>주의해야 할 부분은 환경변수가 ‘어떤 process환경’ 에서 접근 가능한 변수라는 부분 입니다. 위의 printenv로 확인 가능한 환경변수는 해당 shell(terminal) process 환경에서 접근 가능한 환경 변수를 보여줍니다.</p>\n<p>만약 사용자가 어떤 ‘node application’을 구동한 경우, node 프로그램상에서 process.env[key] 로 접근하는 환경변수는, 해당 node process 환경에서 접근 가능한 변수 입니다.</p>\n<p>이는 해당 node 프로그램을 구동하게되는 부모 process(만약 어떤 shell에서 수행했다면)와 항상 동일한게 아니라 각기 독립적일수 있다는 사실을 명심해야 합니다.</p>\n<p>해당 부분은 node 에서 child process을 fork하는 command의 api document을 보면 더 쉽게 이해 가능합니다. 참고: <a href=\"https://nodejs.org/api/child_process.html#child_process_child_process_exec_command_options_callback\">https://nodejs.org/api/child_process.html#child_process_child_process_exec_command_options_callback</a></p>\n<p><strong>webpack env와 혼동하지 말기</strong></p>\n<p>webpack을 이용한 bundle환경을 구축하였을때, 특히 server을 node로 구성하는경우, 위의 기본 개념을 정확하게 이해하지 못해서 환경변수 설정에 대한 실수를 할 가능성이 많습니다.</p>\n<p>webpack역시 node에서 구동되는 node application 이기 때문에 더욱 그러한 경우가 많이 있습니다.</p>\n<p>webpack에서 webpack command을 수행할때, cli환경에서 webpack에 env을 지정 or 넘겨줄 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ webpack --config webpack.config.js --env.MY_ENV<span class=\"token operator\">=</span>test --env.MULTI<span class=\"token operator\">=</span>test_multi</code></pre></div>\n<p>이 경우 env 값에 MY_ENV와 MULTI가 존재하지만 이는 webpack process환경 내에서만 유의미합니다.</p>\n<p>해당 빌드의 결과물로 server.js가 생성되었다고 가정하였을때, node server.js을 하여도, 위 환경변수는 존재하지 않습니다. 왜냐하면, node server.js는 새로운 node process이고, 이 node process을 수행하때, 동일한 환경변수를 지정하지 않았기 때문입니다.</p>\n<p>따라서 해당형태로 구동하고 싶다면, 아래와 같이 새로운 node process 구동시에도 환경변수를 지정해 주어야 합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token assign-left variable\">MY_ENV</span><span class=\"token operator\">=</span>test <span class=\"token assign-left variable\">MULTI</span><span class=\"token operator\">=</span>test_multi <span class=\"token function\">node</span> server.js</code></pre></div>\n<p>결국 기본 개념과 동일한 이야기 인데, 핵심은 어떤 process의 환경변수를 맞추어 주려면 해당 process수행와 동시에 환경변수를 지정해 주어야 합니다.</p>\n<h3 id=\"cross-platform환경에서의-enviroments\" style=\"position:relative;\"><a href=\"#cross-platform%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C%EC%9D%98-enviroments\" aria-label=\"cross platform환경에서의 enviroments permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cross Platform환경에서의 enviroments</h3>\n<p>개발자 개발환경 및 제품(project)의 실행환경이 동일하면 큰 문제가 없지만 만약 window, mac, linux등 서로 다른 환경을 가지고 있을 경우, 각각의 platform 별로 환경 변수를 설정하는 방법에 차이가 있어 문제가 발생 할 수 있습니다.</p>\n<p>따라서 이러한 cross platform 환경에서도 동일한 형태의 환경변수 사용을 위해서 node.js진영에서 많이 사용하는 환경 변수 설정 모듈(유틸)을 소개합니다.</p>\n<p><strong>dotenv</strong></p>\n<p>참고: <a href=\"https://github.com/motdotla/dotenv#readme\">https://github.com/motdotla/dotenv#readme</a></p>\n<p>프로젝트에 .env라는 숨김 파일이나 지정된 파일을, node application실행 전에 적용하여 environment을 설정하는 유틸성 모듈 입니다. node 명령어와 동시에 사용하는 방법도 가능하고, programmatically 하게 사용하는 방법도 가능합니다. 서로다른 platform 에서의 처리는 dotenv가 내부적을 알아서 처리해 줍니다.</p>\n<p>node와 같이 실행</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">node</span> -r dotenv/config your_script.js <span class=\"token assign-left variable\">dotenv_config_path</span><span class=\"token operator\">=</span>/custom/path/to/.env</code></pre></div>\n<p>programmatically 하게 실행</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dotenv'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> <span class=\"token string\">'/custom/path/to/.env'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><strong>crossenv</strong></p>\n<p>참고: <a href=\"https://github.com/kentcdodds/cross-env#readme\">https://github.com/kentcdodds/cross-env#readme</a></p>\n<p>서로 다른 platform와 무관하게, unix형태의 process수행시 env을 설정하는것과 동일한 형태로 env을 설정하면 해당 env을 process env로 설정해주는 유틸성 모듈 입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ cross-env <span class=\"token assign-left variable\">NODE_ENV</span><span class=\"token operator\">=</span>production webpack --config build/webpack.config.js</code></pre></div>\n<p>실제 사용은 unix계열에서 사용하는것고 거의 동일하며, 앞에 cross-env 명령어를 추가해 주는 형태로 사용 가능합니다.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#%EC%86%8C%EA%B0%9C\">소개</a></li>\n<li><a href=\"#cross-platform%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C%EC%9D%98-enviroments\">Cross Platform환경에서의 enviroments</a></li>\n</ul>\n</div>","frontmatter":{"date":"March 18, 2020","title":"Node Env?","categories":"tech-talk","author":"gseok","emoji":null},"fields":{"slug":"/tech-talk-2020/2020-03-18-Node-Env/"}},"prev":{"id":"62f7d583-6c22-5e14-a220-51d7ff4dcb40","html":"<h1 id=\"문제점\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C%EC%A0%90\" aria-label=\"문제점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제점</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeElEQVQoz3XR2XXcMAwF0Kkm8+NjW9RGiRR3ECBIaaYC919GjjSxk58UcPEegNuaSDoQygrtNJQ14uySwbqkQqV8PfGJ4Zn9kUzeZrILuZW2cRD9LzHf1pAnlzplu9W85BLyGnGwiQsV5t6TjKhxV9gMHVt5WIBBiBNrKJONJ1Z2jSg9qESLh/7ClYsMuAYwyCazxWpodyn+wSrRN76S/Zm8hPxKZi7zifN/8E/yVXsJWbq0eBgdMJ948ih93rBtWA22jY5/8LVnt1px1Z49SA8aaI7IXB6NbIaAkAoGBOAClRP4Xoi7mG8G6+xAaCeU1VBUoi2XDc5VAblxtYAeUMjlTfTvw/Tejx/92HX9XUy3qyoOm++/XzXZuGVeInqqzA2RiaqxQRvfj/Ljc/gU45sY7910Xlv6v3+WIQvtLDWViudjo2bL7vhQiQw1GfKSaE2koHTK3nTmH3wGhjza+JoY6uHL7vkI9aET+bJbrLE+XGmxPSeXfgOhRZZFm7oQRwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"01\"\n        title=\"01\"\n        src=\"/static/f3eea9ceb9101a2a8bbadf56567d604d/37523/01.png\"\n        srcset=\"/static/f3eea9ceb9101a2a8bbadf56567d604d/e9ff0/01.png 180w,\n/static/f3eea9ceb9101a2a8bbadf56567d604d/f21e7/01.png 360w,\n/static/f3eea9ceb9101a2a8bbadf56567d604d/37523/01.png 720w,\n/static/f3eea9ceb9101a2a8bbadf56567d604d/302a4/01.png 1080w,\n/static/f3eea9ceb9101a2a8bbadf56567d604d/07a9c/01.png 1440w,\n/static/f3eea9ceb9101a2a8bbadf56567d604d/c6162/01.png 2166w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>pm2의 2.7.0 버전에서, multiple instance사용시, 첫번째 instance만 roate되는 문제\n<ul>\n<li>위 그림을 보면 <code class=\"language-text\">app-out-1.log, app-out-2.log, app-out-3.log, app-out-4.log</code>로 4개의 로그가 instance마다 각각 생성되는데, logroate는 <code class=\"language-text\">app-out-1.log</code> (첫번째 instance의 log)만 되는 문제가 있음을 알 수 있다.</li>\n</ul>\n</li>\n<li>이미 공식 이슈로 이슈업 되어 있다.\n<ul>\n<li>관련이슈: <a href=\"https://github.com/keymetrics/pm2-logrotate/issues/143\">https://github.com/keymetrics/pm2-logrotate/issues/143</a></li>\n</ul>\n</li>\n<li>해결 방법 요약</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  A. pm2을 일시적으로 downgrade(2.7.0 -> 2.6.0) 하면 정상 동작한다.\n  B. pm2는 multiple instance로 사용해도, log는 하나로 쌓게 한다.</code></pre></div>\n<p>위 두가지 방법중 하나를 사용하여 해결 가능하다.</p>\n<h1 id=\"pm2에서-multiple-instance를-사용해도-log는-하나로-합치기\" style=\"position:relative;\"><a href=\"#pm2%EC%97%90%EC%84%9C-multiple-instance%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4%EB%8F%84-log%EB%8A%94-%ED%95%98%EB%82%98%EB%A1%9C-%ED%95%A9%EC%B9%98%EA%B8%B0\" aria-label=\"pm2에서 multiple instance를 사용해도 log는 하나로 합치기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>pm2에서 multiple instance를 사용해도 Log는 하나로 합치기</h1>\n<ul>\n<li>pm2.config.js 파일에 아래와 같이 <code class=\"language-text\">merge_logs: true,</code>을 추가한다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">apps</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'app'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">script</span><span class=\"token operator\">:</span> <span class=\"token string\">'./dist/index.js'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">instances</span><span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">merge_logs</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// !!!! 이렇게 추가!!!</span>\n      <span class=\"token literal-property property\">exec_mode</span><span class=\"token operator\">:</span> <span class=\"token string\">'cluster'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">wait_ready</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">listen_timeout</span><span class=\"token operator\">:</span> <span class=\"token number\">60000</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">max_memory_restart</span><span class=\"token operator\">:</span> <span class=\"token string\">'1024M'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">kill_timeout</span><span class=\"token operator\">:</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h1 id=\"pm2-logroate-conf설정-방법\" style=\"position:relative;\"><a href=\"#pm2-logroate-conf%EC%84%A4%EC%A0%95-%EB%B0%A9%EB%B2%95\" aria-label=\"pm2 logroate conf설정 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>pm2-logroate conf설정 방법</h1>\n<ul>\n<li>추가로 아래와 같이, pm2-logroate 설정도 가능하다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ pm2 set pm2-logrotate:compress true\n$ pm2 set pm2-logrotate:retain 5\n$ pm2 set pm2-logrotate:rotateInterval 0 0 * * *\n$ pm2 set pm2-logrotate:max_size 500M\n$ pm2 set pm2-logrotate:rotateModule true\n$ pm2 set pm2-logrotate:dateFormat YYYY-MM-DD_HH-mm-ss\n$ pm2 set pm2-logrotate:workerInterval 30\n</code></pre></div>\n<ul>\n<li>pm2-logrotate:compress, logroate된 파일을 압축(gzip) 한다.</li>\n<li>pm2-logrotate:retain, rotation된 파일은 5개만 유지한다. (즉 5일치만 유지)</li>\n<li>pm2-logrotate:rotateInterval 0 0 * * *, -> 매일 0 시 0분에 한번 cronjob 형태 (결국 매일 1번!!!) 로 roatation을 발생한다\n<ul>\n<li>이는 cronjob의 설정와 동일하다</li>\n</ul>\n</li>\n<li>pm2-logrotate:max_size 500M, Max 500M까지만 log파일을 유지한다.</li>\n<li>pm2-logrotate:dateFormat YYYY-MM-DD_HH-mm-ss, logroate하는 파일의 파일명의 prefix의 dateFormat설정</li>\n<li>pm2-logrotate:workerInterval 30, logroate하는 checke주기로, 위 max-size에 대한 체크를 한다. 단위는 sec(초)이다. 즉 30이면 30초</li>\n</ul>","frontmatter":{"date":"June 11, 2021","title":"pm2 logroate 가 pm2 멀티 인스턴스에서 이상동작","categories":"tech-talk troubleshooting","author":"gseok","emoji":null},"fields":{"slug":"/tech-talk-2021/2021-06-11-pm2-logroate-not-working/"}},"site":{"siteMetadata":{"siteUrl":"https://gseok.github.io","comments":{"utterances":{"repo":"gseok/gseok.github.com"}}}}},"pageContext":{"slug":"/tech-talk-2021/2021-02-04-SSL-setting-webpack-dev-server/","nextSlug":"/tech-talk-2020/2020-03-18-Node-Env/","prevSlug":"/tech-talk-2021/2021-06-11-pm2-logroate-not-working/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}